bcr_test_module:
  module_path: "examples/httpserver"
  matrix:
    bazel: [8.x]
  tasks:
    ubuntu2204:
      shell_commands:
      - curl https://mise.run | sh
      - ~/.local/bin/mise --version
      - echo 'eval "$(~/.local/bin/mise activate bash)"' >> ~/.bashrc
      - source ~/.bashrc
      - mise use -g erlang@28
      name: "Build/test module on Ubuntu"
      platform: ubuntu2204
      bazel: ${{ bazel }}
      build_targets:
      - "..."
      test_targets:
      - "..."
    # BCR buildkite for macos can't use sudo, so we can't install erlang. As
    # of right now, rules_gleam does not support hermetic build and require
    # erlang to be installed. We're skipping for now.
    #
    # macos:
    #   shell_commands:
    #   - /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    #   - brew install erlang
    #   name: "Run test module on Mac OSX"
    #   platform: macos
    #   bazel: ${{ bazel }}
    #   build_targets:
    #   - "..."
    #   test_targets:
    #   - "..."
